<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PAF Stream ‚Äî Accueil (version locale)</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="header">
    <div class="brand"><img src="logo.png" alt="PAF Stream"></div>
    <div class="menu-btn"><span></span><span></span><span></span></div>
    <nav id="nav-panel" class="nav-panel">
      <a href="index.html">Accueil</a>
      <a href="catalogue.html">Catalogue</a>
      <a href="abonnement.html">Abonnement</a>
      <a href="apropos.html">√Ä propos</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <main>
    <section class="hero">
      <div class="wrap">
        <h1>Vos films, vos histoires, votre Afrique</h1>
        <p>Bienvenue sur PAF Stream ‚Äî d√©couvrez vos meilleurs FILMS, s√©rie, clip vid√©o √† streaming ici.</p>
        <div style="margin-top:10px;">
          <a href="catalogue.html" class="btn">Voir le catalogue</a>
          <a href="abonnement.html" class="btn ghost">S'abonner</a>
        </div>
      </div>
    </section>

    <section style="padding:18px 0">
      <div class="search-box">
        <input id="searchBar" placeholder="üîç Rechercher  ou Genesis..." />
      </div>

      <div class="catalogue" id="catalogue">
        <!-- Genesis -->
        <div class="film-card" onclick="location.href='genesis.html'">
          <img src="genesis.jpg" alt="Genesis">
          <div class="card-body">
            <h3>Genesis (Film)</h3>
            <p>Un film √©motionnel et puissant.</p>
            <div class="price">Acc√®s : 1000 FCFA</div>
            <div style="margin-top:8px"><span class="btn" onclick="event.stopPropagation(); payOrangeMoney('Genesis',1000,'genesis.html')">Payer 1000 FCFA</span></div>
          </div>
        </div>
      </div>

      <p id="noResult" style="display:none;color:#999;margin-top:14px;text-align:center">Aucun r√©sultat</p>
    </section>
  </main>

  <footer class="footer">¬© 2025 PAF Stream ‚Äî Tous droits r√©serv√©s.</footer>

  <!-- AJOUT PAF STREAM : POPUP EMAIL + CODE ORANGE MONEY -->
  <div id="omPopup" style="
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;
  ">
    <div style="background:#fff;padding:20px;border-radius:8px;width:90%;max-width:350px;">
      <h3>Confirmer votre paiement</h3>
      <p>Saisissez votre email et le code de transaction Orange Money.</p>

      <input id="omEmail" placeholder="Votre email" style="width:100%;padding:8px;margin-top:8px;">
      <input id="omCode" placeholder="Code OM re√ßu (r√©f√©rence)" style="width:100%;padding:8px;margin-top:8px;">

      <button onclick="sendConfirmation()" style="margin-top:12px;width:100%;padding:10px;background:#ff6600;color:#fff;border:none;border-radius:5px;">Valider</button>

      <p id="omStatus" style="margin-top:10px;color:#444;font-size:0.9em"></p>
    </div>
  </div>

  <!-- AJOUT PAF STREAM : SCRIPT ORANGE MONEY (version compatible GitHub Pages - stockage local) -->
  <script>
    let currentFilm = null;
    let currentPrice = null;
    let currentRedirect = null;

    function payOrangeMoney(film, price, redirect){
      currentFilm = film;
      currentPrice = price;
      currentRedirect = redirect;

      // 1) Lancer USSD : *150*1*1*TON_NUMERO*PRIX#
      // Note: le navigateur mobile va tenter d'ouvrir l'application t√©l√©phonie.
      const ussd = `tel:*150*1*1*689325213*${price}%23`;
      window.location.href = ussd;

      // 2) Afficher la popup pour email + code OM (l'utilisateur verra la popup apr√®s le paiement)
      setTimeout(()=>{
        document.getElementById('omPopup').style.display = "flex";
      }, 3000);
    }

    // M√©thode locale (simple et gratuite) : on enregistre la preuve de paiement c√¥t√© client (localStorage)
    // IMPORTANT : cette m√©thode n'est pas inviolable ‚Äî c'est une solution rapide pour GitHub Pages.
    function sendConfirmation(){
      const email = document.getElementById('omEmail').value.trim();
      const code = document.getElementById('omCode').value.trim();
      const status = document.getElementById('omStatus');

      if(!email || !code){
        status.innerHTML = "Veuillez remplir tous les champs.";
        return;
      }

      status.innerHTML = "Confirmation enregistr√©e...";

      // R√©cup√®re l'objet des paiements existants
      const payments = JSON.parse(localStorage.getItem("paf_payments") || "{}");
      // Stocke le paiement pour ce film (valeur simple true + m√©tadonn√©es)
      payments[currentFilm] = {
        paid: true,
        price: currentPrice,
        email: email,
        code: code,
        date: new Date().toISOString()
      };
      localStorage.setItem("paf_payments", JSON.stringify(payments));

      // Message √† l'utilisateur puis redirection vers la page du film
      status.innerHTML = "Paiement confirm√© ! Acc√®s en cours‚Ä¶";

      setTimeout(()=>{
        document.getElementById('omPopup').style.display = "none";
        window.location.href = currentRedirect;
      }, 1400);
    }

    // Optionnel : mise √† jour des boutons "Payer" si l'utilisateur a d√©j√† pay√©
    // (ne change pas la structure HTML, juste le texte du bouton)
    window.addEventListener('DOMContentLoaded', ()=>{
      const payments = JSON.parse(localStorage.getItem("paf_payments") || "{}");
      document.querySelectorAll('.film-card').forEach(card => {
        const titleEl = card.querySelector('.card-body h3');
        if(!titleEl) return;
        const title = titleEl.textContent.trim();
        const btn = card.querySelector('.card-body .btn');
        if(payments[title] && btn){
          btn.textContent = 'Regarder';
          btn.onclick = (e)=>{ e.stopPropagation(); location.href = card.getAttribute('onclick')?.match(/'([^']+)'/)?.[1] || currentRedirect; };
        }
      });
    });
  </script>

  <!--
    NOTE POUR LES PAGES DE FILMS (ex : heritiers.html, genesis.html)

    Ajoute en haut de chaque page film (avant d'afficher l'iframe) ce petit script pour v√©rifier que l'utilisateur a pay√© :

    <script>
      const payments = JSON.parse(localStorage.getItem('paf_payments') || '{}');
      if(!payments[''] || !payments[''].paid){
        // redirige vers l'accueil si l'utilisateur n'a pas pay√©
        window.location.href = 'index.html';
      }
    </script>

    Remplace '' par le titre exact utilis√© sur la page catalogue.

    TESTS √† effectuer:
    1) Ouvre index.html sur ton t√©l√©phone, clique sur "Payer" -> l'USSD doit s'ouvrir (ou √™tre propos√©). Apr√®s le paiement, remplis la popup avec email+code.
    2) Apr√®s validation, tu dois √™tre redirig√© vers la page du film et pouvoir visionner la vid√©o.
    3) V√©rifie dans la console (localStorage) que l'objet "paf_payments" contient les donn√©es.

    Quand tu veux √©voluer vers une version plus s√©curis√©e (EmailJS, backend, webhook OM), je pr√©parerai l'√©tape suivante.
  -->

</body>
</html>
